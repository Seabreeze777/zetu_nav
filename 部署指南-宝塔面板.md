# ğŸš€ æ³½é€”ç½‘ - å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### âœ… å·²å®Œæˆé…ç½®
- [x] æ•°æ®åº“å·²è¿æ¥åˆ°æœåŠ¡å™¨ï¼ˆPrismaï¼‰
- [x] è…¾è®¯äº‘COSå·²é…ç½®ä¸ºæœåŠ¡å™¨ç‰ˆæœ¬
- [x] Logoå’Œå›¾ç‰‡èµ„æºå·²å‡†å¤‡å¥½

### ğŸ“ éœ€è¦é…ç½®çš„å†…å®¹

---

## 1ï¸âƒ£ ç¯å¢ƒå˜é‡é…ç½®

### ğŸ“ é¡¹ç›®å·²æä¾›ä¸‰ä¸ªé…ç½®æ–‡ä»¶æ¨¡æ¿ï¼š

- **`.env.example`** - é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼ˆå‚è€ƒç”¨ï¼‰
- **`.env.development`** - å¼€å‘ç¯å¢ƒé…ç½®ï¼ˆæœ¬åœ°å¼€å‘ç”¨ï¼‰
- **`.env.production`** - ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆæœåŠ¡å™¨éƒ¨ç½²ç”¨ï¼‰

### âš ï¸ é‡è¦è¯´æ˜ï¼š

**ä¸ºä»€ä¹ˆéœ€è¦åœ¨æœåŠ¡å™¨å•ç‹¬åˆ›å»º.envæ–‡ä»¶ï¼Ÿ**

1. **å®‰å…¨åŸå› **ï¼š`.env` æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆæ•°æ®åº“å¯†ç ã€å¯†é’¥ç­‰ï¼‰ï¼Œä¸èƒ½æäº¤åˆ°Git
2. **ç¯å¢ƒéš”ç¦»**ï¼šå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®ä¸åŒï¼ˆæ•°æ®åº“åœ°å€ã€åŸŸåç­‰ï¼‰
3. **Next.jsç‰¹æ€§**ï¼šç¯å¢ƒå˜é‡åœ¨**æ„å»ºæ—¶**è¢«è¯»å–å¹¶æ³¨å…¥ä»£ç ï¼Œä½†`.env`æ–‡ä»¶æœ¬èº«**ä¸ä¼šè¢«æ‰“åŒ…**

### ğŸ”§ æœåŠ¡å™¨éƒ¨ç½²æ—¶çš„é…ç½®æ–¹æ³•ï¼š

#### æ–¹æ³•Aï¼šä½¿ç”¨ .env.productionï¼ˆæ¨èï¼‰

1. åœ¨æœåŠ¡å™¨é¡¹ç›®ç›®å½•åˆ›å»º `.env.production` æ–‡ä»¶ï¼š

```bash
# ç”Ÿäº§ç¯å¢ƒé…ç½®
DATABASE_URL="mysql://ç”¨æˆ·å:å¯†ç @æœåŠ¡å™¨IP:3306/æ•°æ®åº“å"
JWT_SECRET="ç”Ÿäº§ç¯å¢ƒè¶…é•¿éšæœºå¯†é’¥-è‡³å°‘64ä½"
COS_SECRET_ID="ä½ çš„ç”Ÿäº§ç¯å¢ƒSecretId"
COS_SECRET_KEY="ä½ çš„ç”Ÿäº§ç¯å¢ƒSecretKey"
COS_BUCKET="ä½ çš„ç”Ÿäº§ç¯å¢ƒå­˜å‚¨æ¡¶"
COS_REGION="ap-beijing"
NODE_ENV="production"
ADMIN_DEFAULT_PASSWORD="Admin@123456"
NEXT_PUBLIC_SITE_URL="https://ä½ çš„åŸŸå.com"
```

2. Next.jsä¼šè‡ªåŠ¨æ ¹æ® `NODE_ENV=production` åŠ è½½ `.env.production`

#### æ–¹æ³•Bï¼šç›´æ¥ä½¿ç”¨ .env

åœ¨æœåŠ¡å™¨é¡¹ç›®ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼Œå¡«å…¥ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆå†…å®¹åŒä¸Šï¼‰

### ğŸ” ç”Ÿæˆå®‰å…¨çš„JWTå¯†é’¥

åœ¨æœ¬åœ°ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆéšæœºå¯†é’¥ï¼š

```bash
# Windows PowerShell
-join ((65..90) + (97..122) + (48..57) | Get-Random -Count 64 | % {[char]$_})

# Linux/Mac
openssl rand -base64 48
```

---

## 2ï¸âƒ£ å®å¡”é¢æ¿é…ç½®æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…å¿…è¦è½¯ä»¶

åœ¨å®å¡”é¢æ¿å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š
- âœ… **Nginx** 1.20+
- âœ… **MySQL** 5.7+ æˆ– 8.0
- âœ… **PM2** ç®¡ç†å™¨ï¼ˆNode.jsé¡¹ç›®ç®¡ç†ï¼‰
- âœ… **Node.js** 18.x æˆ– 20.xï¼ˆæ¨è20.xï¼‰

---

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ é¡¹ç›®æ–‡ä»¶

#### æ–¹æ³•Aï¼šä½¿ç”¨Gitï¼ˆæ¨èï¼‰

1. åœ¨å®å¡”é¢æ¿ â†’ æ–‡ä»¶ â†’ åˆ›å»ºç½‘ç«™ç›®å½•ï¼š
   ```
   /www/wwwroot/zetu
   ```

2. SSHè¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¿›å…¥ç›®å½•ï¼š
   ```bash
   cd /www/wwwroot/zetu
   ```

3. å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœä½¿ç”¨Gitï¼‰ï¼š
   ```bash
   git clone ä½ çš„ä»“åº“åœ°å€ .
   ```

#### æ–¹æ³•Bï¼šç›´æ¥ä¸Šä¼ 

1. æ‰“åŒ…æœ¬åœ°é¡¹ç›®ï¼ˆæ’é™¤ä»¥ä¸‹å†…å®¹ï¼‰ï¼š
   - `node_modules/`
   - `.next/`
   - `.git/`
   - `.env.local`
   - `*.log`

2. é€šè¿‡å®å¡”é¢æ¿ä¸Šä¼ ZIPæ–‡ä»¶å¹¶è§£å‹

---

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

1. åœ¨å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ ä½ çš„ç½‘ç«™ â†’ è®¾ç½® â†’ é…ç½®æ–‡ä»¶

2. åœ¨ç½‘ç«™ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä¸Šé¢çš„ç¯å¢ƒå˜é‡å†…å®¹

---

### ç¬¬å››æ­¥ï¼šå®‰è£…ä¾èµ–

SSHè¿æ¥æœåŠ¡å™¨ï¼Œè¿›å…¥é¡¹ç›®ç›®å½•ï¼š

```bash
cd /www/wwwroot/zetu

# å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿï¼‰
npm install --registry=https://registry.npmmirror.com

# æˆ–è€…ä½¿ç”¨yarn
yarn install --registry=https://registry.npmmirror.com
```

---

### ç¬¬äº”æ­¥ï¼šæ•°æ®åº“åˆå§‹åŒ–

```bash
# ç”ŸæˆPrismaå®¢æˆ·ç«¯
npx prisma generate

# æ¨é€æ•°æ®åº“ç»“æ„
npx prisma db push

# åˆå§‹åŒ–æ•°æ®ï¼ˆå¯é€‰ï¼Œå¦‚æœæ•°æ®åº“ä¸ºç©ºï¼‰
npm run seed
```

---

### ç¬¬å…­æ­¥ï¼šæ„å»ºé¡¹ç›®

```bash
# ç”Ÿäº§ç¯å¢ƒæ„å»º
npm run build

# æ„å»ºæˆåŠŸåä¼šç”Ÿæˆ .next ç›®å½•
```

---

### ç¬¬ä¸ƒæ­¥ï¼šé…ç½®PM2å¯åŠ¨

1. åœ¨å®å¡”é¢æ¿ â†’ è½¯ä»¶å•†åº— â†’ PM2ç®¡ç†å™¨ â†’ è®¾ç½®

2. æ·»åŠ é¡¹ç›®ï¼š
   - **é¡¹ç›®åç§°**ï¼šzetu
   - **å¯åŠ¨æ–‡ä»¶è·¯å¾„**ï¼šé€‰æ‹©é¡¹ç›®ç›®å½•
   - **è¿è¡Œç›®å½•**ï¼š`/www/wwwroot/zetu`
   - **å¯åŠ¨å‘½ä»¤**ï¼š`npm run start`
   - **ç«¯å£**ï¼š3000ï¼ˆæˆ–å…¶ä»–æœªå ç”¨ç«¯å£ï¼‰

3. æˆ–è€…ä½¿ç”¨å‘½ä»¤è¡Œå¯åŠ¨ï¼š
   ```bash
   pm2 start npm --name "zetu" -- start
   pm2 save
   pm2 startup
   ```

---

### ç¬¬å…«æ­¥ï¼šé…ç½®Nginxåå‘ä»£ç†

1. å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ ä½ çš„ç½‘ç«™ â†’ è®¾ç½® â†’ åå‘ä»£ç†

2. æ·»åŠ åå‘ä»£ç†ï¼š
   - **ä»£ç†åç§°**ï¼šzetu-app
   - **ç›®æ ‡URL**ï¼š`http://127.0.0.1:3000`
   - **å‘é€åŸŸå**ï¼š`$host`

3. æˆ–è€…æ‰‹åŠ¨ä¿®æ”¹Nginxé…ç½®ï¼š

```nginx
server {
    listen 80;
    server_name ä½ çš„åŸŸå.com;
    
    # SSLé…ç½®ï¼ˆå¦‚æœæœ‰è¯ä¹¦ï¼‰
    # listen 443 ssl http2;
    # ssl_certificate /path/to/cert.pem;
    # ssl_certificate_key /path/to/key.pem;

    # é™æ€èµ„æºç¼“å­˜
    location /_next/static/ {
        proxy_pass http://127.0.0.1:3000;
        proxy_cache_valid 200 365d;
        add_header Cache-Control "public, immutable";
    }

    location /images/ {
        proxy_pass http://127.0.0.1:3000;
        proxy_cache_valid 200 7d;
        add_header Cache-Control "public";
    }

    location /icons/ {
        proxy_pass http://127.0.0.1:3000;
        proxy_cache_valid 200 30d;
        add_header Cache-Control "public";
    }

    # Next.jsåº”ç”¨
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

---

### ç¬¬ä¹æ­¥ï¼šé…ç½®SSLè¯ä¹¦ï¼ˆæ¨èï¼‰

1. å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ SSL â†’ Let's Encrypt
2. é€‰æ‹©åŸŸåå¹¶ç”³è¯·å…è´¹è¯ä¹¦
3. å¼€å¯å¼ºåˆ¶HTTPS

---

## 3ï¸âƒ£ é¡¹ç›®é…ç½®æ–‡ä»¶æ£€æŸ¥

### `next.config.js`

å½“å‰é…ç½®å·²ä¼˜åŒ–ï¼Œ**æ— éœ€ä¿®æ”¹**ï¼š

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    remotePatterns: [
      { protocol: 'https', hostname: '**' },
      { protocol: 'http', hostname: '**' },
    ],
    dangerouslyAllowSVG: true,
    contentDispositionType: 'attachment',
    contentSecurityPolicy: "default-src 'self'; script-src 'none'; sandbox;",
    minimumCacheTTL: 60,
    unoptimized: true,
  },
}

module.exports = nextConfig
```

### `package.json` scripts

å·²é…ç½®å®Œæˆï¼Œ**æ— éœ€ä¿®æ”¹**ï¼š

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  }
}
```

---

## 4ï¸âƒ£ åå°ç®¡ç†é…ç½®

### ç®¡ç†å‘˜è´¦å·

éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®ï¼š`https://ä½ çš„åŸŸå.com/admin/login`

**é»˜è®¤è´¦å·**ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`.env` ä¸­é…ç½®çš„ `ADMIN_DEFAULT_PASSWORD`

**âš ï¸ é‡è¦**ï¼šé¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹å¯†ç ï¼

---

### ç³»ç»Ÿé…ç½®

ç™»å½•åå°åï¼Œä¾æ¬¡é…ç½®ï¼š

1. **ç³»ç»Ÿé…ç½®**ï¼ˆåå° â†’ ç³»ç»Ÿé…ç½®ï¼‰
   - ç½‘ç«™åç§°
   - ç½‘ç«™æè¿°
   - å¤‡æ¡ˆå·
   - è”ç³»é‚®ç®±

2. **UIé…ç½®**ï¼ˆåå° â†’ UIé…ç½®ï¼‰
   - Heroæ ·å¼ï¼ˆé»˜è®¤ï¼šæç®€æ‰“å­—æœºï¼‰
   - å…¬å‘Šæ å¼€å…³

3. **å…¬å‘Šç®¡ç†**ï¼ˆåå° â†’ å…¬å‘Šç®¡ç†ï¼‰
   - æ·»åŠ /ç¼–è¾‘å…¬å‘Šå†…å®¹

---

## 5ï¸âƒ£ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šé¡µé¢500é”™è¯¯

**åŸå› **ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥.envé…ç½®
cat .env

# æµ‹è¯•æ•°æ®åº“è¿æ¥
npx prisma db push
```

---

### é—®é¢˜2ï¼šé™æ€èµ„æº404

**åŸå› **ï¼šæ„å»ºä¸å®Œæ•´æˆ–è·¯å¾„é”™è¯¯

**è§£å†³**ï¼š
```bash
# é‡æ–°æ„å»º
rm -rf .next
npm run build

# é‡å¯PM2
pm2 restart zetu
```

---

### é—®é¢˜3ï¼šå›¾ç‰‡ä¸Šä¼ å¤±è´¥

**åŸå› **ï¼šCOSé…ç½®é”™è¯¯

**è§£å†³**ï¼š
1. æ£€æŸ¥ `.env` ä¸­çš„COSé…ç½®
2. ç¡®è®¤å­˜å‚¨æ¡¶æƒé™ï¼ˆå…¬æœ‰è¯»ï¼Œç§æœ‰å†™ï¼‰
3. æ£€æŸ¥CORSé…ç½®

---

### é—®é¢˜4ï¼šç«¯å£è¢«å ç”¨

**æŸ¥çœ‹ç«¯å£å ç”¨**ï¼š
```bash
# æŸ¥çœ‹3000ç«¯å£
netstat -tunlp | grep 3000

# æˆ–ä½¿ç”¨lsof
lsof -i :3000
```

**è§£å†³**ï¼š
1. ä¿®æ”¹ `.env` æ·»åŠ  `PORT=å…¶ä»–ç«¯å£`
2. æ›´æ–°Nginxåå‘ä»£ç†é…ç½®

---

## 6ï¸âƒ£ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¼€å¯Gzipå‹ç¼©

åœ¨Nginxé…ç½®ä¸­æ·»åŠ ï¼š

```nginx
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss;
```

---

### 2. é…ç½®CDNï¼ˆå¯é€‰ï¼‰

å°†é™æ€èµ„æºï¼ˆ`/icons/`, `/images/`ï¼‰é…ç½®åˆ°CDNåŠ é€Ÿã€‚

---

### 3. PM2é›†ç¾¤æ¨¡å¼ï¼ˆé«˜æµé‡ï¼‰

```bash
pm2 start npm --name "zetu" -i max -- start
```

---

## 7ï¸âƒ£ éƒ¨ç½²åæ£€æŸ¥æ¸…å•

- [ ] ç½‘ç«™å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] ç®¡ç†åå°å¯ä»¥ç™»å½•
- [ ] å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] å…¬å‘Šæ˜¾ç¤ºæ­£å¸¸
- [ ] æœç´¢åŠŸèƒ½æ­£å¸¸
- [ ] é¡µè„šLogoå’ŒäºŒç»´ç æ­£å¸¸æ˜¾ç¤º
- [ ] SSLè¯ä¹¦å·²é…ç½®ï¼ˆHTTPSï¼‰
- [ ] å¤‡æ¡ˆå·é“¾æ¥æ­£ç¡®
- [ ] QQç¾¤é“¾æ¥å¯ä»¥æ‰“å¼€

---

## 8ï¸âƒ£ æ—¥å¸¸ç»´æŠ¤å‘½ä»¤

### æŸ¥çœ‹æ—¥å¿—

```bash
# PM2æ—¥å¿—
pm2 logs zetu

# å®æ—¶æ—¥å¿—
pm2 logs zetu --lines 50
```

### é‡å¯åº”ç”¨

```bash
# é‡å¯
pm2 restart zetu

# é‡æ–°åŠ è½½ï¼ˆé›¶åœæœºï¼‰
pm2 reload zetu
```

### æ›´æ–°ä»£ç 

```bash
cd /www/wwwroot/zetu

# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# å®‰è£…æ–°ä¾èµ–
npm install

# é‡æ–°æ„å»º
npm run build

# é‡å¯åº”ç”¨
pm2 restart zetu
```

---

## 9ï¸âƒ£ å¤‡ä»½ç­–ç•¥

### æ•°æ®åº“å¤‡ä»½

å®å¡”é¢æ¿ â†’ æ•°æ®åº“ â†’ å®šæ—¶å¤‡ä»½ï¼ˆæ¯å¤©å‡Œæ™¨ï¼‰

### æ–‡ä»¶å¤‡ä»½

å®å¡”é¢æ¿ â†’ è®¡åˆ’ä»»åŠ¡ â†’ å¤‡ä»½ç½‘ç«™

---

## ğŸ‰ éƒ¨ç½²å®Œæˆï¼

è®¿é—®ä½ çš„ç½‘ç«™ï¼š`https://ä½ çš„åŸŸå.com`

ç®¡ç†åå°ï¼š`https://ä½ çš„åŸŸå.com/admin/login`

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- QQï¼š317881378
- å¾®ä¿¡ï¼šSeabreeze_888
- é‚®ç®±ï¼šæŸ¥çœ‹ç³»ç»Ÿé…ç½®

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸš€**

