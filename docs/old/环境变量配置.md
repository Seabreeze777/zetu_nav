# 🔧 环境变量配置说明

本文档详细说明项目所需的所有环境变量配置。

---

## 📝 配置文件

在项目根目录创建 `.env` 文件，内容如下：

```env
# ==================== 数据库配置 ====================
DATABASE_URL="mysql://zetu-nav:your-password@localhost:3306/zetu-nav"

# ==================== JWT配置 ====================
JWT_SECRET="your-super-secret-jwt-key-please-change-this-in-production"

# ==================== 腾讯云COS配置（可选）====================
TENCENT_SECRET_ID="AKIDxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
TENCENT_SECRET_KEY="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
COS_BUCKET="zetu-nav-1302966033"
COS_REGION="ap-chengdu"
```

---

## 📋 环境变量详解

### 必需配置

#### 1. DATABASE_URL（必需）

**说明：** MySQL数据库连接字符串

**格式：**
```
mysql://用户名:密码@数据库地址:端口/数据库名
```

**示例：**
```env
# 本地开发
DATABASE_URL="mysql://root:password@localhost:3306/zetu-nav"

# 腾讯云数据库
DATABASE_URL="mysql://zetu-nav:0dae0b6a05@111.231.204.182:3306/zetu-nav"

# PlanetScale（如使用）
DATABASE_URL="mysql://xxxxx:xxxxx@aws.connect.psdb.cloud/zetu-nav?sslaccept=strict"
```

**注意事项：**
- 确保数据库用户有足够的权限（CRUD权限）
- 端口号通常为3306
- 如果密码包含特殊字符，需要URL编码

---

#### 2. JWT_SECRET（必需）

**说明：** 用于JWT Token加密的密钥

**要求：**
- 至少32个字符
- 使用强随机字符串
- 生产环境必须修改

**生成方法：**

方法1 - 使用Node.js：
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

方法2 - 使用OpenSSL：
```bash
openssl rand -hex 32
```

方法3 - 在线生成器：
```
https://www.lastpass.com/password-generator
```

**示例：**
```env
JWT_SECRET="a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6"
```

**⚠️ 安全警告：**
- 不要使用默认值或简单字符串
- 不要将生产环境密钥提交到代码仓库
- 定期轮换密钥（建议每3-6个月）

---

### 可选配置（腾讯云COS）

如果需要图片上传功能，需要配置以下环境变量。

#### 3. TENCENT_SECRET_ID（可选）

**说明：** 腾讯云API密钥ID

**获取方式：**
1. 登录 [腾讯云控制台](https://console.cloud.tencent.com/cam/capi)
2. 进入「访问管理」→「访问密钥」→「API密钥管理」
3. 创建新密钥或查看现有密钥

**格式：**
```
AKID + 32位字符
```

**示例：**
```env
TENCENT_SECRET_ID="AKIDz8krbsJ5yKBZQpn74WFkmLPx3EXAMPLE"
```

---

#### 4. TENCENT_SECRET_KEY（可选）

**说明：** 腾讯云API密钥Key

**获取方式：** 同上（与SecretId一起生成）

**格式：**
```
32位字符
```

**示例：**
```env
TENCENT_SECRET_KEY="Gu5t9xGARNpq86cd98joQYCN3EXAMPLE"
```

**⚠️ 安全警告：**
- 密钥只显示一次，请妥善保管
- 不要将密钥提交到Git仓库
- 建议使用子账号密钥，限制权限

---

#### 5. COS_BUCKET（可选）

**说明：** COS存储桶名称（包含APPID后缀）

**获取方式：**
1. 登录 [COS控制台](https://console.cloud.tencent.com/cos)
2. 查看存储桶列表
3. 完整名称格式为：`bucket-name-APPID`

**示例：**
```env
COS_BUCKET="zetu-nav-1302966033"
```

---

#### 6. COS_REGION（可选）

**说明：** COS存储桶所属地域

**可选值：**
| 地域 | 简称 |
|------|------|
| 北京 | `ap-beijing` |
| 上海 | `ap-shanghai` |
| 广州 | `ap-guangzhou` |
| 成都 | `ap-chengdu` |
| 香港 | `ap-hongkong` |
| 新加坡 | `ap-singapore` |

**示例：**
```env
COS_REGION="ap-chengdu"
```

---

## 🔐 安全最佳实践

### 1. 本地开发

创建 `.env` 文件（不要提交到Git）：

```env
DATABASE_URL="mysql://root:password@localhost:3306/zetu-nav"
JWT_SECRET="dev-only-secret-key-not-for-production"
```

### 2. 生产环境

**方式1 - 服务器环境变量：**
```bash
# 在服务器上设置环境变量
export DATABASE_URL="..."
export JWT_SECRET="..."
```

**方式2 - PM2配置：**

创建 `ecosystem.config.js`：
```javascript
module.exports = {
  apps: [{
    name: 'zetu-nav',
    script: 'npm',
    args: 'start',
    env: {
      NODE_ENV: 'production',
      DATABASE_URL: 'mysql://...',
      JWT_SECRET: 'xxx',
    }
  }]
}
```

**方式3 - Docker Compose：**
```yaml
services:
  app:
    environment:
      - DATABASE_URL=mysql://...
      - JWT_SECRET=xxx
```

**方式4 - Vercel/Netlify：**

在平台控制台的「Environment Variables」中配置。

### 3. Git忽略

确保 `.gitignore` 包含：
```
.env
.env.local
.env.production
.env.*.local
```

---

## ✅ 配置检查

### 检查清单

创建文件后，请确认：

- [ ] `.env` 文件已创建
- [ ] `DATABASE_URL` 已配置且可以连接
- [ ] `JWT_SECRET` 已设置为强随机字符串
- [ ] `.env` 文件已添加到 `.gitignore`
- [ ] 生产环境使用不同的密钥

### 测试连接

运行以下命令测试数据库连接：

```bash
npx prisma db push
```

如果成功，说明数据库配置正确。

---

## 🐛 常见问题

### Q1: 环境变量不生效

**解决方案：**
1. 确认 `.env` 文件在项目根目录
2. 重启开发服务器（`npm run dev`）
3. 检查变量名拼写是否正确
4. 确保没有多余的空格或引号

### Q2: 数据库连接失败

**检查：**
```bash
# 测试数据库连接
mysql -h 数据库地址 -P 端口 -u 用户名 -p
```

**常见原因：**
- 数据库服务未启动
- 用户名或密码错误
- 防火墙未开放端口
- 用户权限不足

### Q3: Vercel部署找不到环境变量

**解决：**
1. 在Vercel控制台配置环境变量
2. 不要在 `.env` 文件中配置（Vercel不读取）
3. 重新部署项目

---

## 📚 相关文档

- [部署指南](./部署指南.md)
- [腾讯云COS配置](./腾讯云COS配置指南.md)
- [Prisma环境变量](https://www.prisma.io/docs/guides/database/troubleshooting-orm/help-articles/nextjs-prisma-client-dev-practices)

---

**配置完成后，就可以启动项目了！** 🚀

