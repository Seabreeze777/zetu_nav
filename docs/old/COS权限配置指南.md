# 腾讯云COS权限配置指南

## 问题：上传成功但无法访问图片

### 错误现象
- 上传成功，返回URL
- 访问URL显示：`Access Denied`（访问被拒绝）
- 预览图片无法显示

### 原因
腾讯云COS默认为**私有读写**，需要配置为**公有读**才能直接访问。

---

## 解决方案（二选一）

### 方案1：代码设置文件ACL（已实现✅）

在上传文件时自动设置为公有读：

```typescript
cosClient.putObject({
  // ...
  ACL: 'public-read', // 设置文件为公有读
})
```

**优点：** 自动化，无需手动配置
**缺点：** 需要账号有设置ACL的权限

---

### 方案2：在腾讯云控制台设置存储桶权限

#### 步骤1：登录腾讯云控制台
https://console.cloud.tencent.com/cos/bucket

#### 步骤2：找到你的存储桶
点击存储桶名称：`zetu-nav-1302966033`

#### 步骤3：设置权限
1. 左侧菜单选择 **「权限管理」** → **「存储桶访问权限」**
2. 找到 **「公共权限」** 部分
3. 设置为：
   - **公有读私有写** 或
   - **公有读写**（不推荐，允许任何人上传）

#### 推荐配置：
```
公共权限：公有读私有写
用户权限：仅授权用户可写
```

#### 步骤4：保存设置
点击「保存」或「确定」

---

## 方案3：使用存储桶策略（精细化控制）

如果只想让特定文件夹公有读：

### 在「权限管理」→「Policy权限设置」添加策略：

```json
{
  "version": "2.0",
  "statement": [
    {
      "principal": {
        "qcs": ["*"]
      },
      "effect": "allow",
      "action": [
        "name/cos:GetObject"
      ],
      "resource": [
        "qcs::cos:ap-chengdu:uid/1302966033:zetu-nav-1302966033/images/*",
        "qcs::cos:ap-chengdu:uid/1302966033:zetu-nav-1302966033/logos/*",
        "qcs::cos:ap-chengdu:uid/1302966033:zetu-nav-1302966033/covers/*"
      ]
    }
  ]
}
```

**说明：** 只允许公开读取 `images/`、`logos/`、`covers/` 文件夹的内容。

---

## 验证配置

### 测试文件访问
上传一张图片后，直接访问URL：
```
https://zetu-nav-1302966033.cos.ap-chengdu.myqcloud.com/test/xxx.png
```

**成功标志：** 图片正常显示
**失败标志：** 显示 XML 错误 `Access Denied`

---

## 安全建议

1. **推荐：公有读私有写**
   - 允许任何人查看图片
   - 只有授权用户可上传

2. **不推荐：公有读写**
   - 任何人都可以上传文件
   - 可能被恶意使用

3. **使用防盗链（可选）**
   - 在「安全管理」→「防盗链设置」
   - 添加白名单域名
   - 防止其他网站盗用你的图片

4. **开启CDN加速（可选）**
   - 在「域名与传输管理」→「自定义CDN加速域名」
   - 提升全球访问速度
   - 降低COS直接访问流量费用

---

## 常见问题

### Q1: 为什么有些图片能访问，有些不能？
A: 可能是部分图片没有设置 `ACL: 'public-read'`。重新上传即可。

### Q2: 设置公有读后，之前上传的图片还是无法访问？
A: 需要批量修改已有文件的ACL。使用COS控制台或SDK批量设置。

### Q3: 不想存储桶完全公开怎么办？
A: 使用「方案3：存储桶策略」，仅开放特定文件夹。

### Q4: 担心图片被盗链？
A: 设置防盗链白名单，只允许你的域名访问。

