# ⚡ 快速配置指南

## 🎯 3分钟完成配置

### 📝 问题1：QQ图标已修复 ✅

页脚的QQ号前面的图标已经改为和按钮一样的QQ企鹅图标。

刷新浏览器即可看到效果！

---

### 📝 问题2：环境变量配置说明

#### **为什么要创建.env文件？**

简单来说：**`.env` 文件不会被打包！**

```
你的代码打包过程：
  
  npm run build
      ↓
  读取 .env 文件（环境变量）
      ↓
  把变量值注入到代码中
      ↓
  生成 .next/ 目录（打包后的代码）
      ↓
  .env 文件本身不会被复制！❌
```

所以：
- 本地开发：需要创建 `.env.development`
- 服务器部署：需要创建 `.env.production`

---

### 📝 问题3：开发/生产环境配置

#### **是的！可以用两个配置文件！**

Next.js 支持多环境配置：

| 文件 | 用途 | 何时加载 |
|------|------|---------|
| `.env.development` | 本地开发 | `npm run dev` |
| `.env.production` | 服务器部署 | `npm run build` + `npm run start` |

#### **NEXT_PUBLIC_SITE_URL 配置：**

```bash
# .env.development（本地）
NEXT_PUBLIC_SITE_URL="http://localhost:3000"

# .env.production（服务器）
NEXT_PUBLIC_SITE_URL="https://你的域名.com"
```

---

## 🚀 本地开发配置（2分钟）

### 步骤1：复制配置文件

在项目根目录，复制示例文件：

```bash
# Windows 命令提示符
copy env.development.example .env.development

# Linux / Mac / Git Bash
cp env.development.example .env.development
```

### 步骤2：编辑配置

打开 `.env.development` 文件，修改以下内容：

```bash
# 1. 修改数据库密码（如果你的MySQL密码不是默认）
DATABASE_URL="mysql://root:你的密码@localhost:3306/navigation_db"

# 2. 填入腾讯云COS配置
COS_SECRET_ID="你的SecretId"
COS_SECRET_KEY="你的SecretKey"
COS_BUCKET="你的存储桶"

# 3. 其他保持默认即可
```

### 步骤3：启动开发服务器

```bash
npm run dev
```

✅ 完成！访问 http://localhost:3000

---

## 🌐 服务器部署配置（3分钟）

### 方法A：在服务器手动创建（推荐）

#### 1. SSH连接服务器

```bash
ssh root@你的服务器IP
```

#### 2. 进入项目目录

```bash
cd /www/wwwroot/你的项目目录
```

#### 3. 创建配置文件

```bash
nano .env.production
```

#### 4. 粘贴以下内容并修改

```bash
# 数据库配置（改成你的真实信息）
DATABASE_URL="mysql://用户名:密码@127.0.0.1:3306/数据库名"

# JWT密钥（生成强随机密钥！）
# 生成方法：openssl rand -base64 64
JWT_SECRET="粘贴生成的随机密钥"

# COS配置
COS_SECRET_ID="你的SecretId"
COS_SECRET_KEY="你的SecretKey"
COS_BUCKET="你的存储桶"
COS_REGION="ap-beijing"

# 环境
NODE_ENV="production"

# 管理员密码
ADMIN_DEFAULT_PASSWORD="Admin@123456"

# 网站域名（改成真实域名！）
NEXT_PUBLIC_SITE_URL="https://你的域名.com"
```

#### 5. 保存并构建

```bash
# 按 Ctrl+X，然后 Y，然后 Enter 保存

# 构建项目
npm run build

# 启动服务
pm2 start npm --name zetu -- start
```

✅ 完成！访问你的域名测试！

---

### 方法B：本地准备好再上传

#### 1. 本地创建文件

在项目根目录创建 `.env.production` 文件，内容同上。

#### 2. 上传到服务器

使用FTP或宝塔面板上传整个项目（包括 `.env.production`）

⚠️ **注意**：上传前确保 `.env.production` 中填入的是**服务器配置**，不是本地配置！

#### 3. 服务器上构建

```bash
cd /www/wwwroot/你的项目
npm install
npm run build
pm2 start npm --name zetu -- start
```

---

## 🔐 生成JWT密钥

### Windows PowerShell

```powershell
-join ((65..90) + (97..122) + (48..57) | Get-Random -Count 64 | % {[char]$_})
```

### Linux / Mac

```bash
openssl rand -base64 64
```

**复制生成的密钥**，粘贴到 `JWT_SECRET` 配置项！

---

## ✅ 配置检查清单

### 本地开发

- [ ] 已创建 `.env.development` 文件
- [ ] 数据库地址是 `localhost`
- [ ] COS配置已填写
- [ ] `npm run dev` 可以正常启动

### 服务器部署

- [ ] 已创建 `.env.production` 文件
- [ ] 数据库地址是服务器IP（不是localhost）
- [ ] JWT_SECRET 已改为强随机密钥
- [ ] `NEXT_PUBLIC_SITE_URL` 已改为真实域名
- [ ] `npm run build` 构建成功
- [ ] PM2已启动项目
- [ ] Nginx反向代理已配置
- [ ] 网站可以正常访问

---

## 📞 遇到问题？

### 常见错误1：数据库连接失败

**现象**：页面500错误

**解决**：
1. 检查 `.env.production` 中的数据库配置
2. 确认MySQL服务已启动
3. 确认数据库用户权限

```bash
# 测试数据库连接
npx prisma db push
```

---

### 常见错误2：环境变量不生效

**现象**：配置修改后没有变化

**解决**：
1. 修改 `.env` 文件后必须重新构建！
2. 执行以下命令：

```bash
# 重新构建
npm run build

# 重启PM2
pm2 restart zetu
```

---

### 常见错误3：图片上传失败

**现象**：上传图片报错

**解决**：
1. 检查COS配置是否正确
2. 检查存储桶权限（公有读、私有写）
3. 检查CORS配置

---

## 📚 详细文档

- **完整部署指南**：查看 `部署指南-宝塔面板.md`
- **环境变量详解**：查看 `环境变量配置说明.md`
- **配置文件示例**：
  - 开发环境：`env.development.example`
  - 生产环境：`env.production.example`

---

**配置完成！开始开发吧！** 🎉

